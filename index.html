<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Pomodoro Timer</title>

<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
    /* --- CSS Variables for Theming --- */
    :root {
        --font-primary: 'Poppins', sans-serif;
        --font-logo: 'Pacifico', cursive;

        /* Light Mode Colors */
        --color-bg: #f4f7fa;
        --color-surface: #ffffff;
        --color-text-primary: #1a202c;
        --color-text-secondary: #718096;
        --color-accent: #e53e3e; /* Red */
        --color-accent-dark: #c53030;
        --color-border: #e2e8f0;
        --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);

        /* Footer Colors */
        --footer-bg: #1a202c;
        --footer-text: #a0aec0;
        --footer-heading: #edf2f7;

        /* Dark Mode Toggle Colors */
        --toggle-bg-off: #e53e3e; /* Red for "off" */
        --toggle-bg-on: #ffffff;  /* White for "on" */
        /* Added for highlight hover effect */
        --color-accent-rgb: 229, 62, 62; /* RGB for --color-accent */
    }

    body.dark-mode {
        /* Dark Mode Colors */
        --color-bg: #1a202c;
        --color-surface: #2d3748;
        --color-text-primary: #edf2f7;
        --color-text-secondary: #a0aec0;
        --color-accent: #f56565; /* Lighter Red */
        --color-accent-dark: #e53e3e;
        --color-border: #4a5568;
        --shadow: 0 4px 6px rgba(0, 0, 0, 0.25);
        
        /* Dark Mode Footer Colors */
        --footer-bg: #0f131a; /* Even darker for contrast */

         /* Added for highlight hover effect in dark mode */
         --color-accent-rgb: 245, 101, 101; /* RGB for --color-accent in dark mode */
    }

    /* --- General Styles --- */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }
    body {
        font-family: var(--font-primary);
        background-color: var(--color-bg);
        color: var(--color-text-primary);
        display: flex;
        transition: background-color 0.3s, color 0.3s;
    }

    /* --- Sidebar --- */
    .sidebar {
        width: 240px; height: 100vh; background-color: var(--color-surface);
        border-right: 1px solid var(--color-border); padding: 2rem 1.5rem;
        display: flex; flex-direction: column; box-shadow: var(--shadow);
        position: fixed; transition: background-color 0.3s, border-color 0.3s; z-index: 10;
    }
    .sidebar .logo {
        font-family: var(--font-logo); font-size: 2.5rem; color: var(--color-accent);
        text-align: center; margin-bottom: 3rem;
    }
    .sidebar ul { list-style: none; }
    .sidebar ul li a {
        display: block; padding: 1rem; margin-bottom: 0.5rem; text-decoration: none;
        color: var(--color-text-secondary); font-weight: 600; border-radius: 8px;
        transition: background-color 0.2s, color 0.2s;
    }
    .sidebar ul li a:hover, .sidebar ul li a.active { background-color: var(--color-accent); color: white; }

    /* --- Main Content Area --- */
    .main-content {
        flex-grow: 1; margin-left: 240px; /* Same as sidebar width */
        padding: 2rem 3rem; display: flex; flex-direction: column; min-height: 100vh;
    }
    main, section { flex-shrink: 0; }
    .page-content { flex-grow: 1; }

    header { display: flex; justify-content: flex-end; align-items: center; margin-bottom: 2rem; }
    /* --- Dark Mode Toggle Switch --- */
    .dark-mode-switch { position: relative; display: inline-block; width: 60px; height: 34px; }
    .dark-mode-switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--toggle-bg-off); transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--toggle-bg-on); }
    input:checked + .slider:before { transform: translateX(26px); background-color: var(--color-accent); }

    /* --- Generic Section Styles --- */
    .content-section { padding-top: 4rem; margin-top: -2rem; }
    .content-block { background-color: var(--color-surface); padding: 2rem; border-radius: 12px; box-shadow: var(--shadow); transition: background-color 0.3s; margin-bottom: 2rem; }
    .content-block h2 { color: var(--color-text-primary); margin-bottom: 1.5rem; }
    .content-block h3 { color: var(--color-text-primary); margin-bottom: 1rem; }

    /* --- Timer Section --- */
    #timer-display { font-size: 10rem; font-weight: 700; text-align: center; color: var(--color-text-primary); line-height: 1; margin-bottom: 2rem; }
    .timer-controls { max-width: 500px; margin: 0 auto; }
    .time-setter { display: flex; justify-content: center; align-items: center; gap: 1rem; margin-bottom: 1.5rem; }
    .time-setter label { font-weight: 600; color: var(--color-text-secondary); }
    #time-input, #time-unit-select { padding: 0.5rem; border-radius: 6px; border: 1px solid var(--color-border); background-color: var(--color-bg); color: var(--color-text-primary); font-size: 1rem; font-weight: 600; }
    #time-input { width: 100px; text-align: center; }
    #time-input:focus, #time-unit-select:focus { outline: none; border-color: var(--color-accent); box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.3); }
    .buttons { text-align: center; }
    .buttons button { font-family: var(--font-primary); font-size: 1.1rem; font-weight: 600; padding: 0.8rem 2rem; margin: 0 0.5rem; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.2s, transform 0.1s; }
    .buttons button:active { transform: translateY(1px); }
    #start-pause-btn { background-color: var(--color-accent); color: white; }
    #start-pause-btn:hover { background-color: var(--color-accent-dark); }
    #reset-btn { background-color: var(--color-text-secondary); color: white; }
    #reset-btn:hover { background-color: #4a5568; }

    /* --- Statistics Section CSS --- */
    .column-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 1rem; margin-bottom: 1rem; border-bottom: 2px solid var(--color-border); }
    .column-header h2 { margin: 0; padding: 0; border: none; font-size: 1.5rem; }
    #toggle-sessions-btn { background: none; border: none; cursor: pointer; padding: 0.5rem; }
    #toggle-sessions-btn svg { width: 20px; height: 20px; fill: var(--color-text-secondary); transition: transform 0.3s ease; }
    #toggle-sessions-btn:hover svg { fill: var(--color-accent); }
    #toggle-sessions-btn.toggled svg { transform: rotate(180deg); }

    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
    .placeholder-text { color: var(--color-text-secondary); }
    
    #session-list-container { max-height: 265px; overflow-y: auto; transition: max-height 0.5s ease-in-out; }
    .stats-grid.show-all #session-list-container { max-height: 500px; }

    .session-item { display: flex; justify-content: space-between; padding: 1rem; border-bottom: 1px solid var(--color-border); cursor: pointer; transition: background-color 0.2s, border-left-color 0.2s; border-left: 4px solid transparent; }
    .session-item:last-child { border-bottom: none; }
    .session-item:hover { background-color: rgba(var(--color-accent-rgb), 0.1); }
    .session-item.highlighted { background-color: rgba(var(--color-accent-rgb), 0.2); border-left-color: var(--color-accent); }
    .session-item .date { font-weight: 600; color: var(--color-text-primary); }
    .session-item .duration { color: var(--color-text-secondary); font-weight: 600; }

    .chart-container { height: 250px; display: flex; gap: 10px; align-items: flex-end; justify-content: center; }
    .chart-bar-wrapper { flex: 1; max-width: 60px; display: flex; flex-direction: column; align-items: center; text-align: center; transition: transform 0.3s ease-in-out; cursor: pointer; }
    .chart-bar { width: 100%; background-color: var(--color-accent); border-radius: 4px 4px 0 0; transition: height 0.5s ease-out, background-color 0.3s, transform 0.3s, box-shadow 0.3s, border 0.3s; }
    .bar-label { margin-top: 8px; font-size: 0.8rem; font-weight: 600; color: var(--color-text-secondary); transition: color 0.3s, font-weight 0.3s; }
    
    .chart-bar-wrapper.highlighted { transform: scale(1.1); z-index: 1; }
    .chart-bar-wrapper.highlighted .chart-bar { background-color: gold; box-shadow: 0 0 15px rgba(255, 215, 0, 0.8); transform: scaleY(1.05); border: 2px solid var(--color-accent-dark); }
    .chart-bar-wrapper.highlighted .bar-label { color: var(--color-accent-dark); font-weight: 700; }
    
    /* --- Benefits Section --- */
    #benefits-section .section-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--color-border); }
    #benefits-section .section-header h2 { flex-grow: 1; border-bottom: none; margin-bottom: 0; padding-bottom: 1rem; }
    .translate-button { padding: 0.4rem 0.8rem; border: 1px solid var(--color-border); background-color: transparent; color: var(--color-text-secondary); font-family: var(--font-primary); font-weight: 600; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
    .translate-button:hover { background-color: var(--color-accent); color: white; border-color: var(--color-accent); }
    #benefits-section p { font-size: 1.1rem; line-height: 1.8; color: var(--color-text-secondary); margin-bottom: 1rem; margin-top: 1.5rem;}
    .content-block.rtl { direction: rtl; text-align: right; }
    
    /* --- FOOTER STYLES --- */
    .site-footer { background-color: var(--footer-bg); color: var(--footer-text); padding: 3rem 2rem; margin-top: 4rem; transition: background-color 0.3s; }
    .footer-content { display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 2rem; max-width: 1200px; margin: 0 auto; }
    .footer-brand { flex-basis: 25%; }
    .footer-brand .logo { font-family: var(--font-logo); font-size: 2.5rem; color: var(--color-accent); margin-bottom: 1rem; }
    .footer-brand p { font-size: 0.9rem; line-height: 1.6; }
    .footer-links { display: flex; gap: 4rem; flex-wrap: wrap; }
    .footer-column h4 { color: var(--footer-heading); text-transform: uppercase; font-size: 1rem; letter-spacing: 1px; margin-bottom: 1.5rem; }
    .footer-column ul { list-style: none; }
    .footer-column ul li { margin-bottom: 0.75rem; }
    .footer-column ul a { text-decoration: none; color: var(--footer-text); transition: color 0.2s; }
    .footer-column ul a:hover { color: var(--color-accent); }
    .footer-bottom { text-align: center; margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--color-border); font-size: 0.9rem; }
    .footer-bottom a { color: var(--footer-text); font-weight: 600; text-decoration: none; transition: color 0.2s; }
    .footer-bottom a:hover { color: var(--color-accent); }

    /* --- Responsive Design --- */
    @media (max-width: 1024px) {
        .stats-grid { grid-template-columns: 1fr; }
        .footer-content { flex-direction: column; align-items: center; text-align: center; }
        .footer-links { justify-content: center; }
    }
    @media (max-width: 768px) {
        body { flex-direction: column; }
        .sidebar { width: 100%; height: auto; position: static; flex-direction: row; align-items: center; justify-content: space-between; padding: 1rem; }
        .sidebar .logo { margin-bottom: 0; font-size: 2rem; }
        .sidebar ul { display: flex; }
        .sidebar ul li a { padding: 0.5rem 1rem; }
        .main-content { margin-left: 0; padding: 1rem; }
        #timer-display { font-size: 6rem; }
        .buttons button { padding: 0.8rem 1.2rem; }
        .content-section { padding-top: 2rem; margin-top: -1rem; }
    }
</style>

</head>
<body>

<!-- Left Sidebar -->
<nav class="sidebar">
    <h1 class="logo">Pomodoro</h1>
    <ul>
        <li><a href="#timer-section" class="nav-link active">Timer</a></li>
        <li><a href="#stats-section" class="nav-link">Statistics</a></li>
        <li><a href="#benefits-section" class="nav-link">Benefits</a></li>
    </ul>
</nav>

<!-- Main Content -->
<div class="main-content">
    <div class="page-content">
        <!-- Header with Dark Mode Toggle -->
        <header>
            <label class="dark-mode-switch">
                <input type="checkbox" id="darkModeToggle">
                <span class="slider"></span>
            </label>
        </header>

        <!-- Timer Section -->
        <main id="timer-section" class="content-section">
            <div id="timer-display">25:00</div>
            <div class="timer-controls content-block">
                <div class="time-setter">
                    <label for="time-input">Set Time:</label>
                    <input type="number" id="time-input" value="25" min="1">
                    <select id="time-unit-select">
                        <option value="minutes" selected>Minutes</option>
                        <option value="hours">Hours</option>
                        <option value="seconds">Seconds</option>
                    </select>
                </div>
                <div class="buttons">
                    <button id="start-pause-btn">Start</button>
                    <button id="reset-btn">Reset</button>
                </div>
            </div>
        </main>
        
        <!-- Statistics Section -->
        <section id="stats-section" class="content-section">
            <div class="content-block">
                <div class="stats-grid" id="stats-grid-container">
                    <div>
                        <div class="column-header">
                            <h2>Session History</h2>
                            <button id="toggle-sessions-btn" title="Toggle session history">
                                <svg viewBox="0 0 24 24"><path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"></path></svg>
                            </button>
                        </div>
                        <div id="session-list-container">
                           <p class="placeholder-text">No completed sessions yet.</p>
                        </div>
                    </div>
                    <div>
                        <div class="column-header">
                            <h2>Session Graph</h2>
                        </div>
                        <div id="session-chart-container" class="chart-container">
                           <!-- Chart bars will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Benefits Section -->
        <section id="benefits-section" class="content-section">
            <div class="content-block">
                <div class="section-header">
                    <h2 data-translate-key="benefitsTitle">The Power of the Pomodoro Technique</h2>
                    <button id="translate-btn" class="translate-button">للعربية</button>
                </div>
                <p data-translate-key="benefitsIntro">The Pomodoro Technique is a time management method that uses a timer to break work into intervals, traditionally 25 minutes in length, separated by short breaks. Each interval is known as a pomodoro. Here are some of its key benefits:</p>
                <p data-translate-key="benefitsFocus"><strong>Improves Focus:</strong> By dedicating a set amount of time to a single task, you train your brain to resist distractions and maintain deep concentration.</p>
                <p data-translate-key="benefitsBurnout"><strong>Reduces Burnout:</strong> Regular, short breaks are built into the system, allowing your mind to rest and recharge. This prevents mental fatigue and keeps you motivated throughout the day.</p>
                <p data-translate-key="benefitsAccountability"><strong>Increases Accountability:</strong> The timer creates a sense of urgency and helps you track exactly where your time is going, making it easier to plan your work and stay on schedule.</p>
            </div>
        </section>

        <!-- =========== START: YOUR FIREBASE CODE ADDED HERE =========== -->
        <section class="content-section">
            <div class="content-block">
                <h2>🔐 Sign Up</h2>
                <input type="email" id="signupEmail" placeholder="Email" style="width:100%; max-width: 300px; padding: 0.5rem; margin-bottom: 0.5rem;"><br>
                <input type="password" id="signupPassword" placeholder="Password" style="width:100%; max-width: 300px; padding: 0.5rem; margin-bottom: 0.5rem;"><br>
                <button onclick="signup()" style="padding: 0.5rem 1rem;">Sign Up</button>
              
                <hr style="margin: 2rem 0;">
              
                <h2>🔓 Login</h2>
                <input type="email" id="email" placeholder="Email" style="width:100%; max-width: 300px; padding: 0.5rem; margin-bottom: 0.5rem;"><br>
                <input type="password" id="password" placeholder="Password" style="width:100%; max-width: 300px; padding: 0.5rem; margin-bottom: 0.5rem;"><br>
                <button onclick="login()" style="padding: 0.5rem 1rem;">Login</button>
              
                <hr style="margin: 2rem 0;">
                <div id="status"></div>
            </div>
        </section>
        <!-- =========== END: YOUR FIREBASE CODE ADDED HERE =========== -->

    </div>

    <!-- FOOTER -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-brand">
                <div class="logo">Pomodoro</div>
                <p>A simple, modern tool to help you focus and boost productivity.</p>
            </div>
            <div class="footer-links">
                <div class="footer-column">
                    <h4>Navigation</h4>
                    <ul>
                        <li><a href="#timer-section">Timer</a></li>
                        <li><a href="#stats-section">Statistics</a></li>
                        <li><a href="#benefits-section">Benefits</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="https://en.wikipedia.org/wiki/Pomodoro_Technique" target="_blank" rel="noopener noreferrer">About the Technique</a></li>
                        <li><a href="https://francescocirillo.com/" target="_blank" rel="noopener noreferrer">Creator's Site</a></li>
                        <li><a href="#">Productivity Tips</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Connect</h4>
                    <ul>
                        <li><a href="https://github.com/SnipTech1" target="_blank" rel="noopener noreferrer">GitHub</a></li>
                        <li><a href="#">Twitter</a></li>
                        <li><a href="mailto:saidzahran68@gmail.com">Contact</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            Copyright © <span id="copyright-year"></span> <a href="https://github.com/SnipTech1/https-studywithmi" target="_blank" rel="noopener noreferrer">sniptech1</a>. All rights reserved.
        </div>
    </footer>
</div>

<!-- Firebase SDKs (as requested) -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>

<!-- Firebase Script (as requested) -->
<script>
  // 🛠️ Firebase config (بدّل البيانات دي ببيانات مشروعك من Firebase Console)
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  // 🧠 Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // ✅ Sign Up
  function signup() {
    const email = document.getElementById("signupEmail").value;
    const password = document.getElementById("signupPassword").value;

    auth.createUserWithEmailAndPassword(email, password)
      .then((userCredential) => {
        const user = userCredential.user;

        return db.collection("users").doc(user.uid).set({
          email: user.email,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
      })
      .then(() => {
        document.getElementById("status").innerText = "✅ Account created successfully!";
      })
      .catch((error) => {
        alert("❌ " + error.message);
      });
  }

  // ✅ Login
  function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    auth.signInWithEmailAndPassword(email, password)
      .then((userCredential) => {
        const user = userCredential.user;
        document.getElementById("status").innerText = `✅ Logged in as ${user.email}`;
      })
      .catch((error) => {
        alert("❌ " + error.message);
      });
  }
</script>

<!-- Original Pomodoro Script (Unchanged) -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Elements (Timer, Theme, etc.) ---
        const timerDisplay = document.getElementById('timer-display');
        const startPauseBtn = document.getElementById('start-pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const timeInput = document.getElementById('time-input');
        const timeUnitSelect = document.getElementById('time-unit-select');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const copyrightYear = document.getElementById('copyright-year');
        const translateBtn = document.getElementById('translate-btn');
        const benefitsContentBlock = document.querySelector('#benefits-section .content-block');
        const elementsToTranslate = benefitsContentBlock.querySelectorAll('[data-translate-key]');
        
        // --- Statistics Elements ---
        const sessionListContainer = document.getElementById('session-list-container');
        const sessionChartContainer = document.getElementById('session-chart-container');
        const toggleSessionsBtn = document.getElementById('toggle-sessions-btn');
        const statsGridContainer = document.getElementById('stats-grid-container');

        // --- State Variables ---
        let timerInterval = null;
        let totalSeconds = 25 * 60;
        let secondsRemaining = totalSeconds;
        let isPaused = true;
        let initialDurationText = "25-minute";
        let isShowingAllSessions = false; // State for the new toggle
        const alarmSound = new Audio('https://www.soundjay.com/buttons/sounds/button-16.mp3');

        // --- Translation Logic (Unchanged) ---
        const translations = {
            en: { benefitsTitle: 'The Power of the Pomodoro Technique', benefitsIntro: 'The Pomodoro Technique is a time management method that uses a timer to break work into intervals, traditionally 25 minutes in length, separated by short breaks. Each interval is known as a pomodoro. Here are some of its key benefits:', benefitsFocus: '<strong>Improves Focus:</strong> By dedicating a set amount of time to a single task, you train your brain to resist distractions and maintain deep concentration.', benefitsBurnout: '<strong>Reduces Burnout:</strong> Regular, short breaks are built into the system, allowing your mind to rest and recharge. This prevents mental fatigue and keeps you motivated throughout the day.', benefitsAccountability: '<strong>Increases Accountability:</strong> The timer creates a sense of urgency and helps you track exactly where your time is going, making it easier to plan your work and stay on schedule.' },
            ar: { benefitsTitle: 'قوة تقنية البومودورو', benefitsIntro: 'تقنية البومودورو هي طريقة لإدارة الوقت تستخدم مؤقتًا لتقسيم العمل إلى فترات، طولها عادةً 25 دقيقة، تفصلها فترات راحة قصيرة. تُعرف كل فترة باسم "بومودورو". إليك بعض فوائدها الرئيسية:', benefitsFocus: '<strong>تحسين التركيز:</strong> من خلال تخصيص فترة زمنية محددة لمهمة واحدة، فإنك تدرب عقلك على مقاومة المشتتات والحفاظ على تركيز عميق.', benefitsBurnout: '<strong>تقليل الإرهاق:</strong> تم دمج فترات الراحة القصيرة والمنتظمة في النظام، مما يسمح لعقلك بالراحة وإعادة الشحن. هذا يمنع التعب الذهني ويبقيك متحفزًا طوال اليوم.', benefitsAccountability: '<strong>زيادة المساءلة:</strong> يخلق المؤقت إحساسًا بالإلحاح ويساعدك على تتبع أين يذهب وقتك بالضبط، مما يسهل تخطيط عملك والبقاء على الجدول الزمني المحدد.' }
        };
        let currentLang = 'en';
        if (translateBtn) {
            translateBtn.addEventListener('click', () => {
                currentLang = currentLang === 'en' ? 'ar' : 'en';
                benefitsContentBlock.classList.toggle('rtl', currentLang === 'ar');
                translateBtn.textContent = currentLang === 'en' ? 'للعربية' : 'English';
                elementsToTranslate.forEach(element => {
                    const key = element.dataset.translateKey;
                    if (translations[currentLang]?.[key]) element.innerHTML = translations[currentLang][key];
                });
            });
        }

        // --- Timer Logic (Unchanged) ---
        const formatDurationText = (value, unit) => `${value}-${unit.slice(0, -1)}`;
        const updateDisplay = () => {
            const hours = Math.floor(secondsRemaining / 3600);
            const minutes = Math.floor((secondsRemaining % 3600) / 60);
            const seconds = secondsRemaining % 60;
            timerDisplay.textContent = (totalSeconds >= 3600)
                ? `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`
                : `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            document.title = `${timerDisplay.textContent} - Pomodoro Timer`;
        };
        const startTimer = () => {
            if (!isPaused) return;
            isPaused = false;
            startPauseBtn.textContent = 'Pause';
            timeInput.disabled = true; timeUnitSelect.disabled = true;
            timerInterval = setInterval(() => {
                secondsRemaining--;
                updateDisplay();
                if (secondsRemaining <= 0) {
                    clearInterval(timerInterval);
                    alarmSound.play();
                    logCompletedSession(totalSeconds); 
                    alert(`Congratulations! You've completed your ${initialDurationText} session.`);
                    resetTimer();
                }
            }, 1000);
        };
        const pauseTimer = () => { isPaused = true; startPauseBtn.textContent = 'Resume'; clearInterval(timerInterval); };
        const resetTimer = () => {
            clearInterval(timerInterval);
            isPaused = true;
            const value = parseInt(timeInput.value, 10);
            const unit = timeUnitSelect.value;
             if (isNaN(value) || value <= 0) {
                alert("Please enter a valid time (positive number).");
                const revertedValue = Math.round(totalSeconds / (timeUnitSelect.value === 'hours' ? 3600 : (timeUnitSelect.value === 'seconds' ? 1 : 60)));
                timeInput.value = Math.max(1, revertedValue);
                 return;
             }
            initialDurationText = formatDurationText(value, unit);
            switch (unit) {
                case 'hours': totalSeconds = value * 3600; break;
                case 'seconds': totalSeconds = value; break;
                default: totalSeconds = value * 60; break;
            }
            secondsRemaining = totalSeconds;
            startPauseBtn.textContent = 'Start';
            timeInput.disabled = false; timeUnitSelect.disabled = false;
            updateDisplay();
        };
        startPauseBtn.addEventListener('click', () => isPaused ? startTimer() : pauseTimer());
        resetBtn.addEventListener('click', resetTimer);
        timeInput.addEventListener('blur', resetTimer); 
        timeInput.addEventListener('keypress', (event) => { if (event.key === 'Enter') resetTimer(); });
        timeUnitSelect.addEventListener('change', resetTimer);
        
        // --- Theme Logic (Unchanged) ---
        const applyTheme = (theme) => {
            document.body.classList.toggle('dark-mode', theme === 'dark');
            darkModeToggle.checked = theme === 'dark';
        };
        darkModeToggle.addEventListener('change', () => {
            const theme = darkModeToggle.checked ? 'dark' : 'light';
            localStorage.setItem('pomodoro-theme', theme);
            applyTheme(theme);
        });

        // --- Statistics Logic (Unchanged) ---
        const getStats = () => JSON.parse(localStorage.getItem('pomodoro-stats')) || [];
        const saveStats = (stats) => localStorage.setItem('pomodoro-stats', JSON.stringify(stats));

        const highlightSession = (sessionId) => {
            document.querySelectorAll('.session-item.highlighted, .chart-bar-wrapper.highlighted').forEach(el => el.classList.remove('highlighted'));
            if (!sessionId) return;
            const listItem = document.querySelector(`.session-item[data-session-id="${sessionId}"]`);
            const chartBar = document.querySelector(`.chart-bar-wrapper[data-session-id="${sessionId}"]`);
            if (listItem) listItem.classList.add('highlighted');
            if (chartBar) chartBar.classList.add('highlighted');
        };

        const renderStatistics = () => {
            const allStats = getStats();
            const sessionsForList = isShowingAllSessions ? [...allStats].reverse() : allStats.slice(-7).reverse();
            const sessionsForChart = allStats.slice(-7);

            if (allStats.length === 0) {
                sessionListContainer.innerHTML = '<p class="placeholder-text">No completed sessions yet.</p>';
                sessionChartContainer.innerHTML = '<p class="placeholder-text" style="text-align:center; margin-top:50px;">Complete a session to see the chart.</p>';
                toggleSessionsBtn.style.display = 'none';
                return;
            }
            toggleSessionsBtn.style.display = 'block';

            sessionListContainer.innerHTML = sessionsForList.map(session => {
                const date = new Date(session.date);
                const formattedDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                const durationInMinutes = Math.round(session.duration / 60);
                return `<div class="session-item" data-session-id="${session.date}">
                            <span class="date">${formattedDate}</span>
                            <span class="duration">${durationInMinutes} min</span>
                        </div>`;
            }).join('');

            const maxDuration = Math.max(...sessionsForChart.map(s => s.duration), 1);
            sessionChartContainer.innerHTML = sessionsForChart.map(session => {
                const barHeightPercentage = (session.duration / maxDuration) * 100;
                const durationInMinutes = Math.round(session.duration / 60);
                return `<div class="chart-bar-wrapper" data-session-id="${session.date}" title="${durationInMinutes} min">
                            <div class="chart-bar" style="height: ${Math.max(barHeightPercentage, 5)}%;"></div>
                            <span class="bar-label">${durationInMinutes}m</span>
                        </div>`;
            }).join('');
            
            document.querySelectorAll('.session-item, .chart-bar-wrapper').forEach(element => {
                element.addEventListener('click', () => highlightSession(element.dataset.sessionId));
            });
        };

        const logCompletedSession = (durationInSeconds) => {
            const stats = getStats();
            stats.push({ date: new Date().toISOString(), duration: durationInSeconds });
            saveStats(stats);
            renderStatistics();
        };

        toggleSessionsBtn.addEventListener('click', () => {
            isShowingAllSessions = !isShowingAllSessions;
            toggleSessionsBtn.classList.toggle('toggled', isShowingAllSessions);
            statsGridContainer.classList.toggle('show-all', isShowingAllSessions);
            renderStatistics();
        });

        // --- Initialization ---
        const init = () => {
            if(copyrightYear) copyrightYear.textContent = new Date().getFullYear();
            const savedTheme = localStorage.getItem('pomodoro-theme') || 'light';
            applyTheme(savedTheme);
            resetTimer(); 
            updateDisplay();
            renderStatistics();
        };

        init();
    });
</script>
</body>
</html>
